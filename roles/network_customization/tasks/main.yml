- name: Install required Ansible dependencies for nmcli
  package:
    state: present
    name: "{{ item }}"
  loop:
    - network-manager
    - python3-dbus
    - libnm-dev
    - NetworkManager-glib



- name: Remove unwanted network services
  package:
    state: absent
    name: "{{ item }}"
  loop:
    - cups
    - cups-daemon
    - cups-server-common
    - avahi-daemon
    - avahi-utils
    - libnss-mdns
    - libavahi-core7


- name: Set DNS to desired value
  nmcli:
    conn_name: "{{ network_interface }}"
    dns4: "{{ dns }}"
    state: present