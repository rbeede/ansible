- name: Remove unwanted network services
  package:
    state: absent
    name: "{{ item }}"
  loop:
    - cups
    - cups-daemon
    - cups-server-common
    - avahi-daemon
    - avahi-utils
    - libnss-mdns
    - libavahi-core7


# Tried using Ansible's  nmcli  module but as of 2020-08-14 it still has
# bugs where it fails with Python module dependencies
# So use a workaround instead
- name: Set DNS via nmcli
  command: nmcli device modify "{{ network_interface }"  ipv4.dns "{{ dns }}"

- name: Ignore DHCP issued DNS
  command: nmcli device modify "{{ network_interface }"  ipv4.ignore-auto-dns true

- name: Apply DNS changes
  command: nmcli device up "{{ network_interface }"

- name: Show current DNS
  command: resolvectl status
