#!/usr/bin/env bash

# Need this for later
SCRIPT_DIR="$( cd "$( dirname "${BASH_SOURCE[0]}" )" >/dev/null 2>&1 && pwd )"


if [ -z "$1" ]; then
	echo "Missing ProjectName, please provide as argument" 1>&2
	# exit kills current script or terminal, return keeps terminal
	exit 254
fi

set -o xtrace


# Don't want previous tests data leaking
# history -c doesn't work because bash scripts disable history but we will span a new instance so clear this way
rm ~/.bash_history
# The original calling session will still have its own history, but we get a clean slate for our script shell


export "ProjectName=$1"
# No trailing / please
export WORKDIR=`realpath --canonicalize-existing ~/Documents`



# Record all of our commands from this point forward
#-----------
# If the  script  command is not running then run it now by replacing the current process with it
[ -z "$TYPESCRIPT" ] && TYPESCRIPT=1 exec /usr/bin/script --append --command "TYPESCRIPT=1  $0 \"$@\""	"$WORKDIR/$ProjectName.script"


echo Script is now recording in "$WORKDIR/$ProjectName.script"
echo


# Do not do this before since $0 may be a relative path we need
cd $WORKDIR



# colored prompt to remind us we are inside the script recorder
export 'PS1=\e[0;35m\u\e[m@\h:\e[1;37m\D{%F %T%z}\e[m \w\$ '

date; date --utc

ip address show

curl http://icanhazip.com


nohup /Software/BurpSuitePro/BurpSuitePro "--project-file=$WORKDIR/$ProjectName.burp" --unpause-spider-and-scanner  1>/dev/null 2>/dev/null  &

echo Waiting for Burp Suite to be ready
while ! curl --output $WORKDIR/burp-ca.der http://localhost:8080/cert 2>/dev/null; do  sleep 0.25; done
openssl x509 -inform der -in $WORKDIR/burp-ca.der -out $WORKDIR/burp-ca.pem

export https_proxy=http://localhost:8080
export http_proxy=$https_proxy



nohup firefox   1>/dev/null 2>/dev/null  &


gcloud info
gcloud config list


which aws

aws --version
aws configure list
aws configure list-profiles

source $SCRIPT_DIR/setup-aws-cli.bash


ps -ef

pwd
ls -lah

# This provides our interactive recorded session keeping our PS1 and other customized settings
PROMPT_COMMAND='PS1="'$PS1'";unset PROMPT_COMMAND' bash
